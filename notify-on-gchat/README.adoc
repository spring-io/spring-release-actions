= Notify on Google Chat

Send workflow run notifications to a Google Chat space. Use this action in any GitHub repository to post status, workflow details, and job results when a run completes.

== Requirements

* A Google Chat space with a webhook (add via *Space settings* → *Apps & integrations* → *Webhooks*)
* The workflow must have permission to use `github.token` (or `GITHUB_TOKEN`) for the `gh run view` API call

== Inputs

|===
| Input | Required | Default | Description
| `gchat-webhook-url` | Yes | — | The Google Chat webhook URL for the space
| `notify-on` | No | `failure` | When to send: `failure` (only on fail/cancel/unsuccessful), `success` (only on success), or `always`
|===

== Sample usage

=== Notify only on failure (default)

Add a job that runs after your main jobs and calls the action. Notifications are sent only when the run has failed, was cancelled, or was otherwise unsuccessful.

[source,yaml]
----
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # ... your build and test steps ...

  notify:
    needs: build
    runs-on: ubuntu-latest
    if: always()  # Run even when build fails
    steps:
      - uses: spring-io/spring-release-actions/notify-on-gchat@v1
        with:
          gchat-webhook-url: ${{ secrets.GCHAT_WEBHOOK_URL }}
----

=== Notify on success

[source,yaml]
----
  notify:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: spring-io/spring-release-actions/notify-on-gchat@v1
        with:
          gchat-webhook-url: ${{ secrets.GCHAT_WEBHOOK_URL }}
          notify-on: success
----

=== Notify on every run (success or failure)

[source,yaml]
----
  notify:
    needs: build
    runs-on: ubuntu-latest
    if: always()
    steps:
      - uses: spring-io/spring-release-actions/notify-on-gchat@v1
        with:
          gchat-webhook-url: ${{ secrets.GCHAT_WEBHOOK_URL }}
          notify-on: always
----

Store the webhook URL as a repository or organization secret (e.g. `GCHAT_WEBHOOK_URL`) so it is not committed to the repo.

== Sample output

The message posted to Google Chat uses plain text with link markup. Examples:

=== Failed run (pull request)

[source,text]
----
<https://github.com/owner/repo/actions/runs/12345|fix: resolve null pointer in auth filter> failed
<https://github.com/owner/repo/actions/workflows/ci.yml?query=branch%3Amain|CI> #42: Pull request #<https://github.com/owner/repo/pull/100|100> opened by <https://github.com/jane|jane>

* <https://github.com/owner/repo/actions/runs/12345/job/1|build> was failure
* <https://github.com/owner/repo/actions/runs/12345/job/2|test> was failure
----

=== Succeeded run (push to branch)

[source,text]
----
<https://github.com/owner/repo/actions/runs/67890|Merge branch 'feature-x' into main> succeeded
<https://github.com/owner/repo/actions/workflows/ci.yml?query=branch%3Amain|CI> #43: Commit <https://github.com/owner/repo/commit/abc1234|abc1234> pushed by <https://github.com/john|john>

* <https://github.com/owner/repo/actions/runs/67890/job/1|build> was success
* <https://github.com/owner/repo/actions/runs/67890/job/2|test> was success
----

=== Manual or scheduled run

[source,text]
----
<https://github.com/owner/repo/actions/runs/11111|Nightly build> succeeded
<https://github.com/owner/repo/actions/workflows/nightly.yml?query=branch%3Amain|Nightly> #10: Run via scheduled workflow

* <https://github.com/owner/repo/actions/runs/11111/job/1|build> was success
----

In Google Chat, the angle-bracket links render as clickable links (e.g. the run title links to the Actions run, workflow name to the workflow page, and each job to its job log).

== Outputs

|===
| Output | Description
| `result` | Overall run status: `succeeded`, `failed`, `cancelled`, or `unsuccessful`
|===

You can use `steps.<id>.outputs.result` from the run-info step (e.g. `steps.run-info.outputs.result`) in later steps if needed.
